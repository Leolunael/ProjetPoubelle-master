{% extends 'base.html.twig' %}

{% block title %}Carte des centres{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <!-- Bootstrap CSS depuis CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        /* Hauteur fixe pour la carte */
        #map {
            height: 400px;
            width: 100%;
            border-radius: 0.375rem; /* arrondi comme Bootstrap */
        }
        @media (max-width: 576px) {
            #map {
                height: 300px;
            }
        }
    </style>
{% endblock %}

{% block body %}
<main class="container my-4">
    <header class="mb-4">
        <h1 class="text-primary">Centres de recyclage</h1>
    </header>

    <section aria-label="Carte des centres de recyclage" class="mb-5">
        <div id="map" role="region" aria-label="Carte interactive des centres de recyclage"></div>
    </section>

    <section aria-label="Liste des centres à proximité">
        <h2 class="mb-3">Centres à proximité</h2>
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for centre in centres %}
                <article class="col">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <h3 class="card-title h5">{{ centre.nom }}</h3>
                            <p class="card-text mb-2">
                                <svg class="bi bi-geo-alt-fill me-1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                                    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zM8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>
                                </svg>
                                {{ centre.adresse }}
                            </p>
                            <p class="card-text">
                                <svg class="bi bi-clock-fill me-1" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
                                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.5.5 0 0 0-1 0v4h3a.5.5 0 0 0 0-1H8V4z"/>
                                </svg>
                                {{ centre.horaires|nl2br }}
                            </p>
                            <a href="{{ path('centre_detail', { id: centre.id }) }}" class="btn btn-outline-primary mt-2">Voir détails</a>
                        </div>
                    </div>
                </article>
            {% else %}
                <p>Aucun centre trouvé.</p>
            {% endfor %}
        </div>
    </section>
</main>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- Bootstrap JS + Popper (optionnel ici) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([45.75, 4.85], 12); // Lyon

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        {% for centre in centres %}
            {% if centre.latitude and centre.longitude %}
                L.marker([{{ centre.latitude }}, {{ centre.longitude }}])
                    .addTo(map)
                    .bindPopup(`
                        <strong>{{ centre.nom|e('js') }}</strong><br>
                        {{ centre.adresse|e('js') }}<br>
                        {{ centre.horaires|nl2br|e('js') }}
                    `);
            {% endif %}
        {% endfor %}
    </script>
{% endblock %}

